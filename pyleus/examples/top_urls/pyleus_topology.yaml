# Top URLs 
# 
# This topology is an example of a streaming top N application. It tracks down
# the 10 most visited urls, with at least 3 visits, within a time window of 10
# minutes. The result is updated every 10 seconds. A fake data source is
# randomly generated by the spout and data are emitted in Json format to show
# a use case of the class JSONFieldsBolt provided with Pyleus.
# Comparing this example with the bandwith monitoring one, it is worth to note
# that it makes use of timestamps and that it uses lists of records instead of
# slot-counters.

name: top_urls

serializer: json

topology:
    - spout:
        name: requests-generator-A 
        module: top_urls.requests_generator

    - spout:
        name: requests-generator-B
        module: top_urls.requests_generator

    - bolt:
        name: extract-fields
        module: top_urls.fields
        parallelism_hint: 3
        groupings:
            - shuffle_grouping: requests-generator-A
            - shuffle_grouping: requests-generator-B

    - bolt:
        name: top-intermediate
        module: top_urls.top_intermediate
        tick_freq_secs: 6
        parallelism_hint: 3
        options:
            time_window: 600
            N: 10 
            min_records: 3
        groupings:
            - fields_grouping:
                component: extract-fields
                fields:
                    - url

    - bolt:
        name: top-global
        module: top_urls.top_global
        tick_freq_secs: 10
        options:
            N: 10 
        groupings:
            - global_grouping: top-intermediate

    - bolt:
        name: log-top
        module: top_urls.log_top
        groupings:
            - global_grouping: top-global
